# Fluent Bit Configuration for Edge Deployment
# Lightweight log collection and forwarding

[SERVICE]
    Flush         5
    Daemon        off
    Log_Level     info
    Parsers_File  parsers.conf
    HTTP_Server   On
    HTTP_Listen   0.0.0.0
    HTTP_Port     2020

[INPUT]
    Name              tail
    Path              /app/logs/*.log
    Parser            json
    Tag               its.camera.ai.*
    Refresh_Interval  30
    Mem_Buf_Limit     5MB
    Skip_Long_Lines   On

[INPUT]
    Name              tail
    Path              /app/logs/error.log
    Parser            multiline
    Tag               its.camera.ai.error
    Multiline_Flush   5
    Buffer_Chunk_Size 32k
    Buffer_Max_Size   256k

[FILTER]
    Name                modify
    Match               its.camera.ai.*
    Add                 environment edge
    Add                 service its-camera-ai

[FILTER]
    Name                grep
    Match               its.camera.ai.*
    Exclude             level DEBUG

[OUTPUT]
    Name                stdout
    Match               its.camera.ai.error
    Format              json_lines

[OUTPUT]
    Name                file
    Match               its.camera.ai.*
    Path                /tmp/fluent-bit-buffer/
    File                edge-logs
    Format              json_lines